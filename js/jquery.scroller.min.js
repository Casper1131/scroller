/****
 * @Author Christopher Stephens Thomas UWI
 * @version 1.0
 * This plugin adds scrolling capabilities
 * to a div with overflow
 ****/
(function(c){String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)};var m={reset:function(){var a=c(this);a.find("ul").css({left:0});return a},forceResize:function(){var a=c(this),b=a.width();settings=a.data("scroller");totalwidth=0;"auto"==settings.space&&(space=e.getSpacing(a));a.find("ul").find("li").each(function(){totalwidth+=c(this).outerWidth(!0)+space});totalwidth+=space;totalwidth>b&&(b=totalwidth);a.find("ul").css({width:b});return a},repositionButton:function(){var a=
c(this),b=a.data("scroller"),h=a.parent(),f=h.find(a).index(a.context);a.find("ul");var d=a.position().top;""!=a.selector&&a.selector&&(f=h.find(a).index(a.selector));"auto"==b.space&&e.getSpacing(c(this));h.find(".scroller-button:eq("+f+")").css({top:d});h.find(".scroller-button.scroll-right:eq("+f+")").css({top:d});return a},getLast:function(){e.getLast(c(this));return c(this).data("lastvisible")},getFirst:function(){e.getFirst(c(this));return c(this).data("firstvisible")},isOver:function(){return e.overflow(c(this))},
isUnder:function(){return e.underflow(c(this))},refit:function(){var a=c(this),b=c(this).data("scroller"),h=b.space;"auto"==b.space&&(h=e.getSpacing(a));e.realign(a.data("scroller").selection,a,h);return a},resize:function(){return c(this).each(function(){var a=c(this),b=a.data("scroller"),h=b.space,f=a.data("oldwidth"),d=a.width(),k=0;"auto"==b.space&&(h=e.getSpacing(a));a.find("ul").find("li").each(function(){k+=c(this).outerWidth(!0)+h});f>d&&(d=f);k>d&&(d=k);d-=e.toPixels(c(this).find("ul").css("paddingLeft"))+
e.toPixels(c(this).find("ul").css("paddingRight"));d+=h;a.find("ul").css({width:d});a.data("newwidth")&&(b=a.data("newwidth"),a.data("oldwidth",b));a.data("newwidth",d);m.repositionButton.call(this);m.refit.call(this)})},update:function(){var a=0,b=c(this),h=b.data("scroller"),f=b.find("ul"),d=h.space,k=f.width();"auto"==h.space&&(d=e.getSpacing(b));f.find("li").each(function(){a+=c(this).outerWidth(!0)+d});a+=d;a>k&&f.css({width:a});m.repositionButton.call(this);return b},init:function(a){var b=
c.extend({},c.fn.scroller.defaults,a);return c(this).each(function(){var a=c(this);a.addClass("scroll-view");if(!c.isNumeric(b.proportion)||1<b.proportion)b.proportion=e.toPercent(b.proportion,a);a.data("scroller",b);if(a.data("scroll-initialized"))return!1;a.height();var f=a.position().top,d=a.find("ul"),k=b.space;a.data("oldwidth",a.width());a.data("scroll-initialized",!0);"auto"==b.space&&(k=e.getSpacing(a));var q=0,g=d.find("li:first").outerHeight(!0)+e.toPixels(a.find("ul").css("paddingTop"));
d.width();var n=a.parent(),l=100*((1-b.proportion)/2),p=b.bspace,r=100*b.proportion-2*p;"absoluteTop"==b.background.position&&n.parent()&&(q=e.toPixels(n.parent().css("paddingTop")));d.css({position:"relative",left:k,height:d.height()});m.resize.call(this);a.css({width:r+"%",left:l+p+"%"}).after("<button  class='scroller-button scroll-right' style='position:absolute;width:"+l+"%;height:"+g+"px;left:"+(l+2*p+r)+"%;top:"+f+"px;z-index:999;margin:0px;padding:0px'></button>").before("<button  class='scroller-button scroll-left' style='position:absolute;width:"+
l+"%;height:"+g+"px;left:0px;top:"+f+"px;z-index:999;margin:0px;padding:0px'></button>");g=n.find(".scroll-right");l=n.find(".scroll-left");"ui"==b.html?(l.button({icons:{primary:"ui-icon-carat-1-w"},text:!1}),g.button({icons:{primary:"ui-icon-carat-1-e"},text:!1}),p=e.toPixels(n.css("paddingTop")),""==b.background.css?a.parent().append("<div class='scroller-background' style='background-image:"+d.css("background-image")+";background-color:"+d.css("background-color")+";height:"+(a.outerHeight()+p+
f)+"px;top:"+(d.position().top-q)+"px'></div>"):c("<div class='scroller-background' style='background-image:"+d.css("background-image")+";background-color:"+d.css("background-color")+";height:"+(a.outerHeight()+p+f)+"px;top:"+(d.position().top-q)+"px'></div>").appendTo(n).css(b.background.css),d.css({background:"none","border-top":"none","border-left":"none","border-right":"none"}),l.css({"margin-right":0,"margin-left":0}),g.css({"margin-right":0,"margin-right":0})):""!=b.html&&(l.html(b.html.buttonLeft),
g.html(b.html.buttonRight));l.click(function(){e.getFirst(a);var b=d.position().left,c=a.data("firstvisible"),f=c.prev(),g=b,l=e.getPadding(a);e.underflow(a)&&(g=b+(a.offset().left-c.offset().left+k),g+=l.left);e.underflow(a)&&(g+=f.width()/2);d.css({left:g})});g.click(function(){e.getLast(a);var b=d.position().left,c=b,f=a.data("lastvisible"),g=f.next(),l=e.getPadding(a);e.overflow(a)&&(c=b-(f.offset().left-a.offset().left+f.outerWidth()+k-a.width()),c-=l.right);e.overflow(a)&&(c-=g.width()/2);d.css({left:c})})})}},
e={rgb2hex:function(a){function b(a){return("0"+parseInt(a).toString(16)).slice(-2)}a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return"#"+b(a[1])+b(a[2])+b(a[3])},getPadding:function(a){var b=a.find("ul"),c={},f=b.css("paddingLeft"),b=b.css("paddingRight"),f=e.toPixels(f,a);a=e.toPixels(b,a);c.left=f;c.right=a;return c},toPixels:function(a,b){a=String(a);return size=a.endsWith("%")?parseInt(a.slice(0,-1))*b.parent().width()/100:a.endsWith("px")?parseInt(a.slice(0,-2)):a.endsWith("em")?10*parseInt(a.slice(0,
-1)):1*a},toPercent:function(a,b){return e.toPixels(a,b)/b.parent().width()},getSpacing:function(a){a=a.find("ul").find("li:first");return a.innerWidth()-a.width()+a.outerWidth()-a.innerWidth()},realign:function(a,b,c){var f=b.find("ul"),d=f.find(a);b.data("started")||f.css({left:0});if(e.overflow(b)){b.data("started",!0);1>d.length&&(e.getLast(b),b.data("lastvisible"),d=f.find(b.data("lastvisible")));a=d.offset().left;var k=d.width(),m=b.offset().left,g=b.width(),d=d.next(),n=e.getPadding(b);a+k>
m+g&&(left=a-(m+g)+k+c,left+=n.right,f.css({left:-left}),e.overflow(b)&&(left+=d.width()/2+c),f.css({left:-left}))}b.data("started",!1)},overflow:function(a){var b=!1,c=a.find("ul");c.width()+c.position().left>a.width()&&(b=!0);return b},underflow:function(a){var b=!1;a.find("ul").offset().left<a.offset().left&&(b=!0);return b},getLast:function(a){a.find("li").each(function(){if(c(this).offset().left>a.width()+a.offset().left)return!1;a.data("lastvisible",c(this))})},getFirst:function(a){a.find("li").each(function(){if(c(this).offset().left+
c(this).width()>a.offset().left)return a.data("firstvisible",c(this)),!1})}};c.fn.scroller=function(){method=arguments[0];m[method]?(method=m[method],arguments=Array.prototype.slice.call(arguments,1)):method=m.init;return method.apply(this,arguments)};c.fn.scroller.defaults={proportion:0.93,bspace:0,space:"auto",selection:"li[aria-selected=true]",html:"ui",background:{position:"",css:""}}})(jQuery);